Текущий статус проекта: **Инфраструктура настроена**.
Развернуты Docker-контейнеры (PostgreSQL, Redis и др.), инициализирована схема БД, реализован модуль Health Check.

---

## 1. ПРАВИЛА РАБОТЫ С GIT

### Структура веток
*   **main** — `Stable/Prod`. Содержит версию, развернутую на боевом сервере.
    *   ⛔️ **Прямые коммиты запрещены.**
    *   ✅ Изменения попадают только через Merge из веток `rel/...`.
*   **dev** — `Development`. Основная ветка разработки.
    *   Сюда стекаются все готовые задачи.
    *   От этой ветки создаются ветки задач (`feat/...`).
*   **feat/название-задачи** — Разработка нового функционала.
    *   Ответвляется от: `dev`.
    *   Вливается в: `dev`.
*   **rel/vX.X.X** — Стабилизация перед релизом.
    *   Ответвляется от: `dev`.
    *   Вливается в: `main` и `dev`.
*   **dbg/название-бага** — Исправление критических ошибок (hotfix).

### Формат коммитов
Шаблон: `тип(модуль): описание действия`

**1. Типы (Types):**
*   `feat`: Новая функциональность.
*   `fix`: Исправление ошибки.
*   `cfg`: Конфигурация, обновление библиотек, .gitignore.
*   `ref`: Рефакторинг (без изменения логики).
*   `test`: Написание тестов.
*   `wip`: Черновик (Work In Progress). **Обязательно удалить/объединить (Squash) перед слиянием!**

**2. Модули (Scopes):**
`auth`, `users`, `catalog`, `trade`, `finance`, `docs`, `chat`, `admin`, `common`, `infra`.

**3. Примеры:**
*   ✅ `feat(auth): реализация стратегии JWT`
*   ✅ `fix(catalog): исправление фильтрации по цене`
*   ✅ `cfg(infra): обновление зависимостей nestjs`
*   ❌ `исправил баги` (нет типа и модуля)
*   ❌ `wip` (нельзя оставлять в истории ветки)

### Алгоритм работы в Sublime Merge
1.  **Checkout dev** → **Pull**. Получить актуальное состояние проекта.
2.  **Create Branch** от `dev`. Назвать по формату: `feat/setup-auth`.
3.  **Work**. Внесение изменений в код.
4.  **Commit**. Фиксация изменений с правильным сообщением.
5.  **Squash** (Опционально). Если в процессе было много мелких коммитов или `wip`, объедините их в один смысловой коммит перед слиянием.
6.  **Merge** в `dev`:
    *   Переключиться на `dev`.
    *   Нажать ПКМ на вашу ветку → **Merge...**
    *   **ВАЖНО:** Выбрать опцию `--no-ff` (No Fast Forward), чтобы сохранить историю ветвления.
7.  **Push**. Отправка изменений на сервер.

---

## 2. ЗАПУСК ПРОЕКТА

### Предварительные требования
*   **Node.js** (v16+)
*   **Docker Desktop** (включенный и запущенный)

### Шаг 1: Клонирование репозитория
```bash
git clone <ссылка_на_репозиторий>
cd prodopt-backend
```

### Шаг 2: Настройка окружения
1.  Скопируйте содержимое файла `.env` (его нужно получить отдельно, он не хранится в Git).
2.  Создайте файл `.env` в корне проекта и вставьте в него скопированное содержимое.

### Шаг 3: Установка зависимостей
```bash
npm install
```

### Шаг 4: Запуск инфраструктуры
Эта команда поднимет все необходимые сервисы (PostgreSQL, Redis, MinIO, Elastic) в фоновом режиме.
```bash
docker compose up -d
```
*Первый запуск может занять несколько минут для скачивания образов.*

### Шаг 5: Применение миграций БД
Эта команда создаст таблицы в базе данных на основе схемы Prisma.
```bash
npx prisma migrate deploy
```

### Шаг 6: Запуск приложения
```bash
npm run start:dev
```
После успешного запуска вы увидите сообщение о старте NestJS приложения.
*   Сервер доступен по адресу: `http://localhost:3000`
*   Проверка состояния: `http://localhost:3000/health`

---

### Полезные команды
*   `docker compose down`: Остановить все сервисы.
*   `npx prisma studio`: Запустить визуальный редактор базы данных.
*   `npx prisma migrate dev --name <имя_миграции>`: Создать новую миграцию после изменения `schema.prisma`.